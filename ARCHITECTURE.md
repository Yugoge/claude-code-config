# ğŸ—ï¸ Claude Code Global Configuration - Architecture

> System architecture and design documentation
> Last updated: 2026-01-08

---

## ğŸ“‹ System Overview

This repository implements a **production-ready Claude Code global configuration** with sophisticated multi-agent orchestration, comprehensive automation hooks, and extensible slash command system.

**Core Components:**
- **Orchestrator**: Coordinates multi-agent workflows via JSON-based communication
- **Specialized Agents**: 14 sub-agents for specific tasks (dev, QA, cleanup, inspection)
- **Automation Hooks**: 21 hooks for session management, safety, and quality control
- **Slash Commands**: 32 commands for artifacts, research, file processing, and workflows
- **Helper Scripts**: 18 scripts supporting agent operations and automation

**Design Philosophy:**
- **Separation of concerns**: Commands orchestrate, agents execute, scripts support
- **JSON-based communication**: All agents communicate via structured JSONs in docs/{workflow}/
- **Git-based discovery**: Rule-inspector analyzes Git history to discover patterns
- **Safety first**: Checkpointing, approval gates, and rollback mechanisms

---

## ğŸ“ Directory Structure

<!-- AUTO-GENERATED by rule-inspector - DO NOT EDIT -->
### Core Directories

- **agents/** (14 agents) - Specialized subagent system prompts
  - orchestrator.md - Multi-agent workflow coordinator
  - dev.md - Implementation specialist
  - qa.md - Quality assurance and validation
  - cleaner.md - Cleanup execution specialist
  - cleanliness-inspector.md - File organization auditor
  - style-inspector.md - Development standards auditor
  - rule-inspector.md - Git-based rule discovery and README generation
  - test-executor.md - Test execution specialist
  - test-validator.md - Test validation specialist
  - artifact-generator.md - React apps and visualizations
  - file-processor.md - Excel, PDF, image processing
  - code-quality-auditor.md - Security and performance analysis
  - deep-search.md - Multi-source research specialist
  - general-purpose.md - General task handling

- **commands/** (32 commands) - Slash command definitions
  - Artifacts: artifact-react.md, artifact-excel-analyzer.md, artifact-mermaid.md, quick-prototype.md
  - File ops: file-analyze.md, docx.md, xlsx.md, pdf.md, pptx.md
  - Development: dev.md, test.md, test-gen.md, code-review.md, refactor.md, optimize.md, debug-help.md, security-check.md
  - Project management: clean.md, status.md, quick-commit.md, doc-gen.md, explain-code.md
  - Research: deep-search.md, research-deep.md, search-tree.md, reflect-search.md, site-navigate.md
  - Thinking: think.md, ultrathink.md
  - Automation: playwright-helper.md, product-self-knowledge.md, frontend-design.md

- **hooks/** (21 hooks) - Automation hooks (session, safety, quality)
  - Session: session_start.sh, ensure-git-repo.sh
  - Safety: pre_tool_use_safety.sh, prevent_destructive_edits.sh
  - Quality: post_tool_use_quality_hints.sh
  - Validation: validate-json.sh, validate-bash.sh
  - Git: check-commit-message.sh, check-for-secrets.sh
  - Integration: context7-reminder.sh, mcp-setup-reminder.sh
  - Workflow: 11 additional specialized hooks

- **scripts/** (18 scripts) - Helper scripts for workflows
  - Core: orchestrator.sh, scan-project.sh
  - File ops: check-file-references.sh, normalize-doc-names.sh, update-gitignore.sh
  - Folder discovery: discover-folders.sh, analyze-folder-history.sh, generate-folder-index.sh, generate-folder-readme.sh
  - Workflow support: scripts/todo/*.py (clean.py, test.py, quick-prototype.py, file-analyze.py, reflect-search.py)
  - Validation: test/scripts/validate-*.py

- **docs/** - Documentation organized by category
  - docs/guides/ - User guides and tutorials
  - docs/reference/ - Technical documentation
  - docs/planning/ - Planning docs and design proposals
  - docs/reports/ - Completion reports and summaries
  - docs/archive/ - Historical documentation (organized by date)
  - docs/examples/ - Example files and templates
  - docs/templates/ - Template files
  - docs/dev/ - Development workflow JSONs
  - docs/clean/ - Clean workflow JSONs
  - docs/test/ - Test workflow JSONs

### Other Directories

- **projects/** - Project-specific configurations
- **logs/** - Log files from workflow executions
- **todos/** - Todo tracking files
- **plugins/** - Plugin configurations
- **venv/** - Python virtual environment for scripts
- **test/** - Test infrastructure and validation scripts
<!-- END AUTO-GENERATED -->

---

## ğŸ”„ Data Flow

### Multi-Agent Workflow Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Command   â”‚  User invokes /dev or /clean
â”‚ Orchestratorâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Build context JSON
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ docs/{workflow}/         â”‚  JSON files store agent communication
â”‚ - context-*.json         â”‚
â”‚ - report-*.json          â”‚
â”‚ - completion-*.json      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Invoke specialized agent
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sub-Agent   â”‚  Reads context, performs task, writes report
â”‚ (dev/qa/    â”‚
â”‚ cleaner)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Report back via JSON
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Orchestratorâ”‚  Reviews report, coordinates next step
â”‚ (Command)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### /dev Workflow Example

1. **Orchestrator** (commands/dev.md):
   - Clarifies requirements via multi-round Q&A
   - Builds comprehensive context JSON
   - Performs git root cause analysis
   - Delegates to dev subagent

2. **Dev Agent** (agents/dev.md):
   - Reads context-dev-*.json
   - Implements changes
   - Creates parameterized scripts if needed
   - Writes dev-report-*.json

3. **QA Agent** (agents/qa.md):
   - Reads dev-report-*.json
   - Validates against success criteria
   - Runs verification scripts
   - Writes qa-report-*.json with pass/fail

4. **Orchestrator**:
   - Reviews QA report
   - Iterates if needed (max 3 rounds)
   - Generates completion report

### /clean Workflow Example

1. **Orchestrator** (commands/clean.md):
   - Builds context JSON with project structure
   - Invokes rule-inspector for README updates
   - Invokes cleanliness-inspector for file issues
   - Invokes style-inspector for standards violations

2. **Inspectors** (agents/{cleanliness,style,rule}-inspector.md):
   - Read context JSON
   - Perform specialized inspection
   - Write report JSONs

3. **Orchestrator**:
   - Merges reports
   - Presents to user
   - Collects approvals

4. **Cleaner Agent** (agents/cleaner.md):
   - Reads approved actions
   - Executes cleanup safely
   - Writes execution report

---

## ğŸ¯ Design Principles

**Maintained by humans - DO NOT AUTO-GENERATE**

### 1. Separation of Concerns
- Commands orchestrate workflows, don't implement logic
- Agents are specialized for specific tasks
- Scripts provide reusable utilities

### 2. Safety First
- Git checkpointing before destructive operations
- Approval gates for all cleanup actions
- Rollback mechanisms (git reset --hard)
- Block operations on sensitive files (.env, credentials)

### 3. Observability
- All agent communication via JSON files
- Comprehensive logging in docs/{workflow}/
- Clear request_id tracking
- Completion reports for every workflow

### 4. Extensibility
- Add new agents by creating .md in agents/
- Add new commands by creating .md in commands/
- Add new hooks by creating .sh in hooks/
- Modify templates without touching orchestration logic

### 5. Documentation as Code
- Git history is source of truth (rule-inspector)
- READMEs auto-generated from patterns
- Freshness checks prevent stale docs
- Auto-update triggers based on structural changes

### 6. Context Preservation
- Full context passed between agents
- No information loss in orchestration
- Rich error reporting with rationale
- Git root cause analysis in all workflows

---

## ğŸ”„ Workflow Types

### Development Workflows (/dev)

**Purpose**: Orchestrated development with QA validation

**Agents involved**:
1. Orchestrator (commands/dev.md)
2. Dev (agents/dev.md)
3. QA (agents/qa.md)

**Communication files**:
- docs/dev/context-dev-*.json
- docs/dev/dev-report-*.json
- docs/dev/qa-report-*.json
- docs/dev/completion-dev-*.md

**Key features**:
- Multi-round requirement clarification
- Git root cause analysis
- Iterative QA validation (max 3 rounds)
- Comprehensive success criteria checking

### Cleanup Workflows (/clean)

**Purpose**: Aggressive project cleanup with safety

**Agents involved**:
1. Orchestrator (commands/clean.md)
2. Rule-inspector (agents/rule-inspector.md)
3. Cleanliness-inspector (agents/cleanliness-inspector.md)
4. Style-inspector (agents/style-inspector.md)
5. Cleaner (agents/cleaner.md)

**Communication files**:
- docs/clean/context-clean-*.json
- docs/clean/rule-context-*.json
- docs/clean/cleanliness-report-*.json
- docs/clean/style-report-*.json
- docs/clean/combined-report-*.json
- docs/clean/user-approvals-*.json
- docs/clean/cleanup-execution-*.json
- docs/clean/completion-clean-*.md

**Key features**:
- README freshness detection and auto-update
- Root documentation special handling (README.md, ARCHITECTURE.md)
- File organization issue detection
- Development standards auditing
- User approval gates
- Git checkpointing

### Test Workflows (/test)

**Purpose**: Test validation and execution

**Agents involved**:
1. Orchestrator (commands/test.md)
2. Test-validator (agents/test-validator.md)
3. Test-executor (agents/test-executor.md)

**Communication files**:
- docs/test/context-test-*.json
- docs/test/validation-report-*.json
- docs/test/execution-report-*.json

---

## ğŸ”Œ Extension Points

### Adding New Agents

1. Create `agents/my-agent.md` with frontmatter:
```markdown
---
name: my-agent
description: When to use this agent
tools: Read, Write, Bash
---

Your agent system prompt here...
```

2. Reference in command orchestrator:
```bash
~/.claude/scripts/orchestrator.sh my-agent-action docs/{workflow}/context.json
```

### Adding New Commands

1. Create `commands/my-command.md` with frontmatter:
```markdown
---
description: My custom command
---

Your command instructions here...
```

2. Command available as `/my-command`

### Adding New Hooks

1. Create `hooks/my-hook.sh`:
```bash
#!/bin/bash
# Your hook logic here
```

2. Add to `settings.json`:
```json
{
  "hooks": {
    "pre_tool_use": ["hooks/my-hook.sh"]
  }
}
```

### Extending Rule-Inspector Templates

Edit `agents/rule-inspector.md`:
- Modify Step 7.5 for new root documentation files
- Update templates in Step 8 for subfolder READMEs
- Add new freshness check logic

---

## ğŸ“ˆ Git Analysis

<!-- AUTO-GENERATED by rule-inspector - DO NOT EDIT -->
Project initialized: 2025-12-27
Last structural update: 2026-01-08
Total commits: 36
<!-- END AUTO-GENERATED -->

---

*ARCHITECTURE.md auto-generated by rule-inspector on 2026-01-08. Design Principles section maintained by humans.*
