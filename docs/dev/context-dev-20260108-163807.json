{
  "request_id": "dev-20260108-142000",
  "timestamp": "2026-01-08T14:20:00Z",
  "requirement": {
    "original": "严重历史问题，为什么会被归入Orphan？clean工作流重大失误。修复工作流",
    "clarified": "Fix /clean workflow's orphaned agent detection logic that incorrectly archived git-edge-case-analyst.md, and restore the agent to proper location with full /test integration",
    "what": "Fix cleanliness-inspector orphan detection + restore git-edge-case-analyst + integrate into /test",
    "why": "git-edge-case-analyst is core component of /test workflow for discovering edge cases via git analysis, but was misidentified as orphaned and archived",
    "where": ["agents/cleanliness-inspector.md", "commands/test.md", "docs/archive/orphaned-agents/git-edge-case-analyst.md"],
    "scope": {
      "included": [
        "Fix orphan detection logic in cleanliness-inspector.md (add exception rules)",
        "Restore git-edge-case-analyst.md from archive to agents/",
        "Integrate git-edge-case-analyst into /test command workflow",
        "Update /test documentation to reflect git analysis step"
      ],
      "excluded": [
        "Modifying other agent files",
        "Changing /clean orchestration logic",
        "Rewriting test-validator or test-executor"
      ]
    },
    "success_criteria": [
      "git-edge-case-analyst.md restored to agents/ directory",
      "cleanliness-inspector has explicit exception for git-edge-case-analyst",
      "/test command references and invokes git-edge-case-analyst",
      "Future /clean runs will not flag git-edge-case-analyst as orphaned",
      "/test workflow includes Git analysis as Step 1 before validator and executor"
    ],
    "constraints": [
      "Must not break existing /test functionality",
      "Must preserve all existing edge case analysis data in docs/test/",
      "Orphan detection logic must still work for truly orphaned agents"
    ]
  },
  "root_cause_analysis": {
    "symptom": "git-edge-case-analyst.md found in docs/archive/orphaned-agents/ instead of agents/",
    "root_cause": "cleanliness-inspector Step 8 orphan detection logic has no awareness of workflow-orchestrated agents that aren't directly referenced in command files",
    "root_cause_commit": "78928f57 - feat: comprehensive project cleanup - resolve all organization issues (2026-01-08 13:20)",
    "why_introduced": "/clean workflow was executing cleanliness-inspector which correctly detected git-edge-case-analyst had zero references in commands/*.md",
    "why_problematic": "git-edge-case-analyst is meant to be invoked dynamically by /test orchestrator, not statically referenced in test.md. But test.md never actually integrated it, so it appeared orphaned AND it was actually not being used!",
    "timeline": "Jan 7 09:23: git-edge-case-analyst created but never integrated → Jan 8 13:20: /clean archived it as orphaned",
    "affected_files": [
      "agents/git-edge-case-analyst.md",
      "agents/cleanliness-inspector.md",
      "commands/test.md",
      "docs/archive/orphaned-agents/git-edge-case-analyst.md"
    ]
  },
  "context": {
    "codebase_state": "8 files modified (ARCHITECTURE.md added, test-gen.md deleted, git-edge-case-analyst orphaned)",
    "git_status": "M README.md, M agents/rule-inspector.md, M commands/clean.md, D commands/test-gen.md, ?? ARCHITECTURE.md",
    "current_agent_location": "docs/archive/orphaned-agents/git-edge-case-analyst.md",
    "orphan_detection_logic": "agents/cleanliness-inspector.md lines 318-364",
    "test_workflow": "commands/test.md lines 1-792 (currently missing git analysis step)",
    "edge_case_data": "docs/test/edge-case-analysis.json (complete 8-case analysis from Jan 7)"
  },
  "development_approach": {
    "strategy": "Three-pronged fix: (1) Add exception logic to cleanliness-inspector, (2) Restore git-edge-case-analyst via git mv, (3) Integrate into /test command as Step 1",
    "files_to_modify": [
      "agents/cleanliness-inspector.md - Add exception list for workflow-orchestrated agents",
      "commands/test.md - Add Step 1 for git-edge-case-analyst invocation",
      "git mv docs/archive/orphaned-agents/git-edge-case-analyst.md agents/git-edge-case-analyst.md"
    ],
    "validation_approach": "QA will verify: (1) git-edge-case-analyst in agents/, (2) exception exists in cleanliness-inspector, (3) test.md references git-edge-case-analyst, (4) run cleanliness-inspector and confirm no orphan warning"
  },
  "standards_to_enforce": {
    "no_hardcoded_values": true,
    "use_source_venv": true,
    "integer_step_numbering": true,
    "meaningful_naming": true,
    "git_root_cause_reference": true
  }
}
