{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"$(date -u +%Y-%m-%dT%H:%M:%SZ) SessionStart: knowledge-system\" >> ~/.claude/session.log"
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 -c \"import sys,json,re; o=json.load(sys.stdin); exit(1) if re.search(r'rm\\s|-rf|rd\\s|del\\s', o['user_input']) else exit(0)\"",
            "stdin_json": true
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 -c \"import sys,json,re; o=json.load(sys.stdin); exit(1) if re.search(r'rm\\s|:>|Format|Set-ItemProperty', o['tool_input']['command']) else exit(0)\"",
            "stdin_json": true
          }
        ]
      },
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "python3 -c \"import sys,json; o=json.load(sys.stdin); edits=o['tool_input'].get('file_edits',[]); exit(1) if any('knowledge-base/_index/' in e.get('path','') for e in edits) else exit(0)\"",
            "stdin_json": true
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/sm2-algorithm.py ] && python scripts/sm2-algorithm.py >/dev/null 2>&1 || true"
          },
          {
            "type": "command",
            "command": "[ -f scripts/rebuild-backlinks.py ] && python scripts/rebuild-backlinks.py || true"
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 -c \"import sys,json,datetime; o=json.load(sys.stdin); open('.review/history.log','a').write(f'{datetime.datetime.utcnow().isoformat()}Z review done\\n') if o.get('subagent_name')=='review-master' else None\"",
            "stdin_json": true
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "[ -f chats/index.json ] && cp chats/index.json chats/index.backup.json || true"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"$(date -u +%Y-%m-%dT%H:%M:%SZ) Stop\" >> ~/.claude/session.log"
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"$(date -u +%Y-%m-%dT%H:%M:%SZ) SessionEnd\" >> ~/.claude/session.log"
          }
        ]
      }
    ]
  }
}


